<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.305">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>hypertidy-blog – readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">hypertidy-blog</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mdsumner"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mdsumner"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<p>#’ #’ https://stackoverflow.com/questions/74705976/how-to-import-sinusoidal-remotesensed-data-into-raster-in-r #’ #’ #’ #’ https://gist.github.com/mdsumner/dbade9bb2a52bc53ce5413bf20c274e2 #’ #’ #’ #’ #’ #’ that looks like L3bin to me, not a raster but a ragged array #’ #’ #’ #’ #’ #’ I’ve got stuff in this package: https://github.com/hypertidy/L3bin #’ #’ #’ #’ Integerized Sinusoidal Binning Scheme for Level 3 Data #’ #’ Website #’ #’ https://hypertidy.github.io/L3bin/ #’ #’ it’s not exactly obvious, or even easy to use - but it’s very cool and readily useable once you understand what L3b is (generally the nasa ocean colour files have “L3m” (for mapped, global grid) vs “L3b” (for L3bin, sparse integerized sinusoidal grid) in the filename (L3m is derived from L3bin, which is stored that way to preserve statistical properties as one step up from L2 swaths summarized into daily bins) - there’s a classic SeaWiFS tech paper about the stats and bins #’ #’ #’ #’ #’ #’ um, but also not easy to read in - I’ve use various forms of HDF5 packages in the past, you have to navigate the compound types and groups in the NetCDF - if you don’t get any feedback I’m happy to show some stuff #’ #’ #’ #’ looks like you can get the bin values from terra, but not the bin index, it’s in a different group in the file and GDAL won’t see it) #’ #’ #’ #’ here’s my old read code https://github.com/sosoc/croc/blob/master/R/read_L3_file_hdf5.R but I very much expect that won’t work out of the box! #’ #’ #’ #’ read_L3_file_hdf5.R #’ #’ #’ Read Level-3 ocean colour. #’ #’ #’ #’ #’ #’ #’ #’ #’ Read the compound types (i.e.&nbsp;tables of variables) from ocean colour L3 NetCDF files. #’ #’ #’ #’ #’ #’ <code>read_binlist</code> for just the ‘BinList’ #’ #’ e #’ #’ <a href="https://github.com/sosoc/croc%7Csosoc/croc" class="uri">https://github.com/sosoc/croc|sosoc/croc</a>sosoc/croc | Added by GitHub #’<br>
#’<br>
#’ Michael Sumner #’ 6 hours ago #’ oh I see there are lon and lat vars in there, and the bin index is there too but hidden #’<br>
#’<br>
#’ Michael Sumner #’ 6 hours ago #’ I’l be back with an answer :grinning: #’ #’ #’ #’ #’ #’ here’s enough to get by on https://gist.github.com/mdsumner/dbade9bb2a52bc53ce5413bf20c274e2, just assuming a longlat grid but you could obviously pick any, I have more crafy bin-summarizing code in other projects IYI #’ :heart: #’ 1 #’<br>
#’<br>
#’<br>
#’ Philippe Massicotte #’ 4 hours ago #’ As usual, #’ <span class="citation" data-cites="mdsumner">@mdsumner</span> #’ you have a simple and elegant solution. Going to experiment it today! #’<br>
#’ I did years of that kind of stuff, the cell thing in raster was a game changer (and fasterize made it blazing) #’<br>
#’ fwiw the lon,lat is entirely redundant given nrows of the grid and bin index, and each bin has a specific bounds based on that (and all are equal area), just there might be more cunning aggregates for you to do based on the bin as group :pray: #’ #’</p>
<p>f &lt;- “~/ESACCI-OC-L3S-CHLOR_A-MERGED-1D_DAILY_4km_SIN_PML_OCx-20070101-fv5.0.nc”</p>
<pre><code>library(tidync)
##
## the bins, this is every single bin for this sinusoidal grid
bins &lt;- tidync::tidync(f) |&gt; activate("D1") |&gt;
 hyper_tibble()


minbin &lt;- bins |&gt; dplyr::filter(lat &gt;=40) |&gt; summarize(bin = min(bin_index)) |&gt; dplyr::pull(bin)
## the bin is for joining on which bin_index is used here
d &lt;- tidync::tidync(f) |&gt; activate("D1,D0") |&gt;
  hyper_filter(bin_index = bin_index &gt;= minbin) |&gt; 
  hyper_tibble(select_var = c("chlor_a")) |&gt; 
  dplyr::inner_join(bins, "bin_index")
  
d$time &lt;- NULL

plot(d$lon, d$lat, pch = ".", col = palr::chl_pal(d$chlor_a), asp = 1/cos(mean(d$lat) * pi/180))
  

## define a raster
library(terra)
r &lt;- terra::rast(terra::ext(c(-180, 180, min(d$lat), max(d$lat))), nrows = 90, ncols = 180, crs = "OGC:CRS84")

cells &lt;- tibble::tibble(cell = terra::cellFromXY(r, cbind(d$lon, d$lat)), chlor_a = d$chlor_a) |&gt; 
  group_by(cell) |&gt; summarize(chlor_a = mean(chlor_a))
r[cells$cell] &lt;- cells$chlor_a
pal &lt;- palr::chl_pal(palette = TRUE)
image(r, col = pal$cols[-1], breaks = pal$breaks)
</code></pre>



</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>